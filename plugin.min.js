tinymce.PluginManager.add('bootgrid', function (editor, url) {
    //setup
    
    console.log(editor);

    //path to plugin
    var path = tinymce.baseURL + '/plugins/bootgrid/';
    var iconpath = path + 'bootgrid-menu-icon.png';

    //editor events

    //https://www.tinymce.com/docs/api/tinymce.dom/tinymce.dom.selection/
    editor.on('keyDown', function (e) {
        //if a bootstrap column
        if (tinymce.activeEditor.selection.getStart().querySelectorAll('div[class^="col-"]')) {
            var startOffset = tinymce.activeEditor.selection.getRng().startOffset;//position of cursor from start of column div

            if (e.keyCode == 8 && startOffset == 1) {
                e.preventDefault();
                jQuery(tinymce.activeEditor.selection.getNode()).html('&nbsp');
            }
        }
    });
    

    editor.addMenuItem('bootgrid-4-4', {
        image: iconpath,
        text: 'Bootgrid |-|-|-|-| columns',
        context: 'tools',
        onclick: function () {
            //add some html!
            var html =  '<div class="row">' +
		                    '<div class="bootgrid-col col-md-3">Col 1</div>' +
		                    '<div class="bootgrid-col col-md-3">Col 2</div>' +
		                    '<div class="bootgrid-col col-md-3">Col 3</div>' +
		                    '<div class="bootgrid-col col-md-3">Col 4</div>' +
	                    '</div><p class="editor-row-spacer">&nbsp;</p>';
            editor.insertContent(html);
            //tinymce.activeEditor.dom.addClass(tinymce.activeEditor.dom.select('p'), 'someclass');
        }
    });

    editor.addMenuItem('bootgrid-8-4', {
        image: iconpath,
        text: 'Bootgrid |--|-| columns',
        context: 'tools',
        onclick: function () {
            var html = '<div class="row">' +
		                    '<div class="bootgrid-col col-md-8">Col 1</div>' +
		                    '<div class="bootgrid-col col-md-4">Col 2</div>' +
	                    '</div><p class="editor-row-spacer">&nbsp;</p>';
            editor.insertContent(html);
        }
    });

    editor.addMenuItem('bootgrid-4-8', {
        image: iconpath,
        text: 'Bootgrid |-|--| columns',
        context: 'tools',
        onclick: function () {
            var html = '<div class="row">' +
		                    '<div class="bootgrid-col col-md-4">Col 1</div>' +
		                    '<div class="bootgrid-col col-md-8">Col 2</div>' +
	                    '</div><p class="editor-row-spacer">&nbsp;</p>';
            editor.insertContent(html);
        }
    });

    editor.addMenuItem('bootgrid-6-6', {
        image: iconpath,
        text: 'Bootgrid |--|--| columns',
        context: 'tools',
        onclick: function () {
            var html = '<div class="row">' +
		                    '<div class="bootgrid-col col-md-6">Col 1</div>' +
		                    '<div class="bootgrid-col col-md-6">Col 2</div>' +
	                    '</div><p class="editor-row-spacer">&nbsp;</p>';
            editor.insertContent(html);
        }
    });

    editor.addMenuItem('bootgrid-3-9', {
        image: iconpath,
        text: 'Bootgrid |-|---| columns',
        context: 'tools',
        onclick: function () {
            var html = '<div class="row">' +
		                    '<div class="bootgrid-col col-md-3">Col 1</div>' +
		                    '<div class="bootgrid-col col-md-9">Col 2</div>' +
	                    '</div><p class="editor-row-spacer">&nbsp;</p>';
            editor.insertContent(html);
        }
    });

    editor.addMenuItem('bootgrid-9-3', {
        image: iconpath,
        text: 'Bootgrid |---|-| columns',
        context: 'tools',
        onclick: function () {
            var html = '<div class="row">' +
		                    '<div class="bootgrid-col col-md-9">Col 1</div>' +
		                    '<div class="bootgrid-col col-md-3">Col 2</div>' +
	                    '</div><p class="editor-row-spacer">&nbsp;</p>';
            editor.insertContent(html);
        }
    });

    editor.addMenuItem('bootgrid-12', {
        image: iconpath,
        text: 'Bootgrid |----| columns',
        context: 'tools',
        onclick: function () {
            var html = '<div class="row">' +
		                    '<div class="bootgrid-col col-md-12">Col 1</div>' +
	                    '</div><p class="editor-row-spacer">&nbsp;</p>';
            editor.insertContent(html);
        }
    });

    //http://stackoverflow.com/questions/5898656/test-if-an-element-contains-a-class
    function hasClass(element, cls) {
        return (' ' + element.className + ' ').indexOf(' ' + cls + ' ') > -1;
    }
});
